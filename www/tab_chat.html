<!DOCTYPE html> 
<html>
<head>
   <meta charset="utf-8">
   <meta name="viewport" content="width=device-width; initial-scale=1.0">
   <title>MangoMango</title>
   <link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css" />
   <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
   <script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
   <script type="text/javascript" src="cordova.js"></script>
   <script type="text/javascript" src="http://cdn.socket.io/socket.io-1.2.1.js"></script>
   <script type="text/javascript" src="js/index.js"></script>

   <!-- <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { font: 13px Helvetica, Arial; }
      form { background: #ffff00; padding: 3px; position: fixed; bottom: 0; width: 100%; }
      form input { border: 0; padding: 10px; width: 50%; margin-right: .5%; }
      form button { width: 9%; background: rgb(130, 224, 255); border: none; padding: 10px; }
      #messages { list-style-type: none; margin: 0; padding: 0; }
      #messages li { padding: 5px 10pax; }
      #messages li:nth-child(odd) { background: #eee; }   
   </style> -->

   <script type="text/javascript">
     
   app.initialize();     
      document.addEventListener('deviceready', function() {
         var socket = io.connect('http://165.132.221.182:8080');
         var User_Name = localStorage.getItem('User_Name');
         var Project_Id = localStorage.getItem('Project_Id');
      
     console.log('chat join');
         
     socket.emit('join', {
        	 User_Name : User_Name,
        	 Project_Id : Project_Id
         });       
         socket.emit('getgreet',User_Name+'님이 접속하셨습니다.');      
         socket.on('connect', function() {   
          $('form').submit(function(){            
             var message = $('#m').val();          
             socket.emit('getmessage', {
                message : message,
                User_Name : User_Name
                }
             );
             $('#m').val('');
             return false;
          });
          socket.on('putgreet', function(msg){         
             $('#messages').append($('<h4 align="center">').text(msg));  
          })
        socket.on('putmessage', function(msg){
         if(msg.User_Name == User_Name){
            $('#messages').append($('<h4 align="right">').text(msg.message));
         }
         else
         {
            $('#messages').append($('<h4 align="left">').text(msg.User_Name));
            $('#messages').append($('<h4 align="left">').text(msg.message));
         }
             var el = document.getElementById('messages');
              el.scrollIntoView(false);
          });

       });
      });
      
      function gotoprj(){

    location.href = 'project_select.html';       
}
   </script>

   <script>
    function gotomypage(){

      location.href = 'mypage.html';       
    }
    function gotoprj(){

      location.href = 'project_select.html';       
    }
    function gotocommunity(){

      location.href = 'App_community.html';       
    }

  </script>

</head> 
<body> 
   <div data-role="page" id="main4">
      <div data-role="panel" id="panel" data-postion="left" data-display="overlay" data-theme="e">
         <h1>설정</h1>
         <ul data-role="listview"  data-theme="e">
            <li><a href="javascript:void();" onclick ="gotomypage();">내 정보</a></li>
            <li><a href="javascript:void();" onclick ="gotoprj();" >프로젝트 선택창</a></li>
            <li><a href="javascript:void();" onclick ="gotocommunity();">커뮤니티</a></li>
            <li><a href="index.html">로그아웃</a></li>
            <li><a href="page" data-rel="close">닫기</a></li>
         </ul>
      </div>

      <!--헤더부분 -->
      <div data-role="header" data-postion="fixed" data-theme="e">
         <a href="#panel" data-icon="gear">설정</a>
         <h1>main화면</h1>
         <div data-role="navbar">
            <ul>
               <li><a href="tab_memo.html" rel="external">내가 할 일</a></li>
               <li><a href="tab_schedule.html" rel="external">일정</a></li>
               <li><a href="tab_addfunc.html" rel="external">부가기능</a></li>
               <li><a href="#" class="ui-btn-active" rel="external">채팅</a></li>
            </ul>
         </div>
      </div>
      <!-- 컨텐츠 부분 -->
      <div data-role="content" data-theme="e">      
         <div class="app">
            <h1>채팅방</h1>
            <div id="deviceready" class="blink">
               <p class="event listening"></p>
               <p class="event received">(채팅시작)</p>
               <div style="width: 100%; height: 220px; border: solid 1px; overflow : scroll; overflow-x : hidden;" id="txtarea">
                  
                     <ul id="messages"></ul>
                  
               </div>
            </div>
         </div>
      </div>

      <div data-role="footer" data-theme="e">
            <form id="" class="ui-grid-b">
              <div class="ui-block-a" style="width:80%">
                <input type="text" id ="m" autocomplete="off" data-inline="true">
              </div>

              <div class="ui-block-c" style="width:5%">
              
              </div>

              <div class="ui-block-c" style="width:15%">
                 <input type="submit" id="target" value="전송" data-inline="true">
              </div>
            </form
      ></div>
   </body>
   </html>